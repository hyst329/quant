{% extends "base.html" %}
{% load bootstrap3 %}
{% load static %}
{% load djangocodemirror_tags %}
{% block content %}

<div class="container">
  <textarea id="code" name="code">Preview your template here.</textarea>
  <iframe id="preview"></iframe>
  <br>
  <button class="btn btn-danger">
    {% bootstrap_icon "save" %}
    Save
  </button>
</div>
{% codemirror_instance 'django' 'code_codemirror' 'code' %}
<script>
  var delay;

  code_codemirror.on("change", function () {
    clearTimeout(delay);
    delay = setTimeout(updatePreview, 300);
  });

  function updatePreview() {
    $.ajax({
      type: "POST",
      url: "/templates/temprender/",
      data: {
        "template": code_codemirror.getValue()
      },
      success: function (data) {
        //$("#preview").html(data);
        var previewFrame = document.getElementById('preview');
        var preview =  previewFrame.contentDocument ||  previewFrame.contentWindow.document;
        preview.open();
        preview.write(/*code_codemirror.getValue()*/data);
        preview.close();
      },
      error: function (xhr, ajaxOptions, thrownError) {
        alert(xhr.status);
        alert(thrownError);
      }
    });
  }

</script>
{% endblock %}